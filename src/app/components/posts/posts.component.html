<div class="d-flex justify-content-end mb-3">
  <button type="button" class="btn btn-outline-light btn-sm" data-bs-toggle="collapse" data-bs-target="#new-post" aria-expanded="false" aria-controls="new-post"><i class="bi bi-file-earmark-plus"></i> Nueva Publicación</button>
</div>

<div class="collapse mb-3" id="new-post">

  <div class="card mb-2">
    <div class="card-header pb-0 text-center fw-semibold text-center">
      <p class="fs-5 pb-0 mb-1 text-white">CREAR NUEVA PUBLICACIÓN</p>
    </div>
    <div class="card-body py-0">
      <form (ngSubmit)="createPost(postForm)" class="my-3" #postForm="ngForm">
        <div class="form-floating mb-3">
          <input 
            type="text" 
            class="form-control" 
            id="titlePost" 
            name="titlePost" 
            [(ngModel)]="post.title"
            placeholder="Titulo" 
            style="height: 15px"
            #titlePost="ngModel"
            maxlength="80"
            required
          >
          <label for="titlePost">Titulo de la Publicación</label>
          @if(titlePost.invalid && (titlePost.dirty || titlePost.touched)){
            @if (titlePost.errors!['required']) {
              <p class="fs-6 text-danger fw-semibold"><i class="bi bi-x-circle-fill"></i> El titulo es obligatorio</p>
            }
            @if(titlePost.errors!['minlength']){
              <p class="fs-6 text-danger fw-semibold"><i class="bi bi-x-circle-fill"></i> El titulo es de maximo 80 caracteres</p>
            }
          }          
        </div>
        <div class="form-floating">
          <textarea 
            class="form-control" 
            id="contentPost" 
            name="contentPost" 
            [(ngModel)]="post.content" 
            #contentPost="ngModel"
            maxlength="2000"
            style="height: 80px"
            placeholder="Contenido de la publicación"
            required
            (input)="contentPostLength = contentPost.value.length"
            ></textarea>
          <label for="contentPost">Contenido de la publicación</label>
          @if(contentPost.invalid && (contentPost.dirty || contentPost.touched)){
            @if (contentPost.errors!['required']) {
              <p class="fs-6 text-danger fw-semibold"><i class="bi bi-x-circle-fill"></i> El contenido de la publicación es obligatorio</p>
            }
            @if(contentPost.errors!['maxlength']){
              <p class="fs-6 text-danger fw-semibold"><i class="bi bi-x-circle-fill"></i> El contenido de la publicación es de maximo 2500 caracteres</p>
            }
          }   
        </div>
        <div class="d-flex justify-content-end mt-3 mb-1">
          <ul>
            <li>
              <p class="text-white text-end mb-1">{{ contentPostLength }} / 2500</p>
            </li>
            <li>
              <button type="submit" class="btn btn-outline-light" [disabled]="postForm.invalid" data-bs-toggle="collapse" data-bs-target="#new-post" aria-expanded="false" aria-controls="new-post"><i class="bi bi-file-earmark-plus"></i> Publicar</button>
            </li>
          </ul>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="alert alert-dark" role="alert">
  <strong>Hola {{user.name}}!</strong> Aquí se muestran las publicaciones de todos los usuarios
</div>

@for (post of posts; track $index) {
  <div class="card mb-3" style="width: 100%;">
    <div class="card-header d-flex justify-content-between pb-0 ">
      <a href="" class="text-decoration-none fw-semibold">{{post.user.name}} {{post.user.lastName}}</a>
      <p class="text-white m-0 mb-2">{{post.postDate | date: 'dd/MM/yyyy'}}</p>
    </div>
    <div class="card-body">
      <h4 class="card-title text-white fw-semibold">{{post.title}}.</h4>
      <p class="card-text text-white content-break mb-0">
        {{ post.readMore ? post.content : (post.content.length > 70 ? post.content.substring(0, 70) + '...' : post.content) }}
      </p>
      @if (post.content.length > 70) {
        <button (click)="readMore(post)" class="btn btn-link px-0 btn-sm">
          {{ post.readMore ? 'Leer menos' : 'Leer más ' }}
        </button>
      }
    </div>
    <div class="card-footer">
      <comments [post]="post"></comments>
    </div>
  </div>
}

@if (paginator.number < paginator.totalPages - 1) {
  <div class="d-flex justify-content-center my-3">
    <button type="button" class="btn btn-outline-light w-75" (click)="morePosts(paginator.number + 1)">Ver más publicaciones...</button>
  </div>
}

